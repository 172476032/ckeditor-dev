<div id="editor"></div>

<script>
	var data = [
			{ id: 1, name: 'john', fullName: 'John Doe' },
			{ id: 2, name: 'thomas', fullName: 'Thomas Doe' },
			{ id: 3, name: 'anna', fullName: 'Anna Doe' },
			{ id: 4, name: 'annabelle', fullName: 'Annabelle Doe' },
			{ id: 5, name: 'cris', fullName: 'Cris Doe' },
			{ id: 6, name: 'julia', fullName: 'Julia Doe' }
		];

	CKEDITOR.replace( 'editor', {
		width: 600,
		mentions: [
			{
				feed: CKEDITOR.tools.array.map( data, function( item ) {
								return item.name;
							} ),
				minChars: 0,
				throttle: 3000
			},
			{
				feed: '{encodedQuery}',
				marker: '$',
				minChars: 0,
				throttle: 3000
			},
			{
				feed: dataCallback,
				marker: '#',
				minChars: 0,
				throttle: 3000
			}
		],
		on: {
			instanceReady: function() {
				// We have to stub ajax.load function.
				CKEDITOR.ajax.load = function( query, callback ) {
					var results = data.filter( function( item ) {
							return item.name.indexOf( query ) === 0;
						} );

					setTimeout( function() {
						callback( JSON.stringify( results ) );
					}, Math.random() * 500 );
				}
			}
		}
	} );

	function dataCallback( opts, callback ) {
		setTimeout( function() {
			callback(
				data.filter( function( item ) {
					return item.name.indexOf( opts.query ) == 0;
				} )
			);
		}, Math.random() * 500 );
	}
</script>
